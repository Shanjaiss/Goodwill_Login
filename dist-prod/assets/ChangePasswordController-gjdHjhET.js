import{r as w,Y as C,S as e,T as j,U as F,V as O,Z as A,X as R}from"./index-Dpf7DlSa.js";import{A as x,F as v,e as u,f as S,g as N,h as q,s as k}from"./FLCommonService-U1oZbLd1.js";var L={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"};function f(){return f=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var l=arguments[a];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(t[o]=l[o])}return t},f.apply(this,arguments)}const V=(t,a)=>w.createElement(C,f({},t,{ref:a,icon:L})),_=w.forwardRef(V),{Link:$}=O,H=({apiKey:t,ProcessTask:a,navigate:l,errorMsg:o,setErrorMsg:c,errorApiKeyMsg:i,setErrorApiKeyMsg:m,form:p})=>e.jsxs(e.Fragment,{children:[(i||o)&&e.jsx(x,{description:i||o,type:"error",onClose:()=>{i?m(null):c(null)}}),e.jsx(x,{description:"Password expired or User logging in for the first time. Please change the password.",type:"info"}),e.jsxs(v,{form:p,layout:"vertical",onFinish:()=>a("submitForm"),children:[e.jsx(u,{name:"clientId",type:"text",placeholder:"ENTER CLIENT ID",required:!0,tooltip:"Client id",rules:[{required:!0,message:"Please enter your Client ID"}]}),e.jsx(u,{name:"oldPassword",type:"password",placeholder:"ENTER OLD PASSWORD",required:!0,tooltip:"Old Password",rules:[{required:!0,message:"Please enter your Old Password"}]}),e.jsx(u,{name:"newPassword",type:"password",placeholder:"ENTER NEW PASSWORD",required:!0,dependencies:["oldPassword"],tooltip:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"Password must:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Be at least 7 characters"}),e.jsx("li",{children:"Have at least one digit"}),e.jsx("li",{children:"Have one lowercase and uppercase letter"}),e.jsx("li",{children:"Have one special character (# $ - * @)"})]})]}),rules:[{required:!0,message:"Please enter your New Password"},({getFieldValue:d})=>({validator(s,r){if(!r)return Promise.resolve();const P=d("oldPassword");return r===P?Promise.reject(new Error("New password must be different from old password")):/[A-Z]/.test(r)?/[a-z]/.test(r)?/[0-9]/.test(r)?/[#@$\-*]/.test(r)?r.length<7?Promise.reject(new Error("Password must be at least 7 characters long")):Promise.resolve():Promise.reject(new Error("Password must contain at least one special character: # @ $ - *")):Promise.reject(new Error("Password must contain at least one number")):Promise.reject(new Error("Password must contain at least one lowercase letter")):Promise.reject(new Error("Password must contain at least one uppercase letter"))}})]}),e.jsx(u,{name:"confirmPassword",type:"password",placeholder:"ENTER CONFIRM PASSWORD",required:!0,tooltip:"Confirm Password",dependencies:["newPassword"],rules:[{required:!0,message:"Please enter your Confirm Password"},({getFieldValue:d})=>({validator(s,r){return!r||d("newPassword")===r?Promise.resolve():Promise.reject(new Error("Confirm password does not match new password"))}})],extra:e.jsx(j,{justify:"end",children:e.jsx(F,{children:e.jsxs($,{className:"custom-link",onClick:()=>l(`/login?api_key=${t}`),children:[e.jsx(_,{})," Back to login"]})})})}),e.jsx(j,{justify:"center",children:e.jsx(S,{label:"Submit",htmlType:"submit"})})]})]}),W=()=>{const[t]=N(),a=A(),[l,o]=w.useState(null),{apiKey:c,errorApiKeyMsg:i,setErrorApiKeyMsg:m}=R();w.useEffect(()=>{const s=localStorage.getItem("clientId");s&&t.setFieldsValue({clientId:s})},[t]);const p=async s=>{var h,g;if(i){console.error("API Key Error present. ");return}o(null);const r=(s==null?void 0:s.clientId)??t.getFieldValue("clientId"),P=(s==null?void 0:s.password)??t.getFieldValue("oldPassword"),y=(s==null?void 0:s.password)??t.getFieldValue("newPassword"),E={api_key:c,clnt_id:r,oldpwd:btoa(P),pwd:btoa(y)};try{const n=await q("changepwd",E);if(n.status==="success"){const b=((h=n.data)==null?void 0:h.dmsg)||"Password changed successfully";k.success(b,10,()=>{a(`/login?api_key=${c}`)})}else n.status==="error"&&o(n.error_msg||"Something went wrong")}catch(n){console.error("API call failed:",n),o(((g=n==null?void 0:n.response)==null?void 0:g.statusText)||"Request failed. Please try again.")}},d=async(s,r=null)=>{switch(s){case"submitForm":p(r);break;default:console.warn("Unknown task:",s)}};return e.jsx(H,{apiKey:c,ProcessTask:d,navigate:a,errorMsg:l,setErrorMsg:o,errorApiKeyMsg:i,setErrorApiKeyMsg:m,form:t})};export{W as ChangePasswordController,W as default};
